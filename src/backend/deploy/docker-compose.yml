version: "3.8"
services:
    doorlock-cloud-api:
        build: ../door_lock_cloud_api/
        ports:
        - "5001:5001"
        restart: always
        depends_on:
          - "mqtt-broker"
          - "doorlock-database"

    mqtt-broker:
        build: ../mqtt_broker/
        ports:
            - "1883:1883"
            - "9001:9001"
            - "18083:18083"
            - "4369:4369"
        volumes:
            - vol-emqx-data:/opt/emqx/data
            - vol-emqx-etc:/opt/emqx/etc
            - vol-emqx-log:/opt/emqx/log

    doorlock-database:
      build: ../door_lock_database/
      ports: 
        - "6379:6379"
      volumes:
          - redis-volume:/data

volumes:
  vol-emqx-data:
    name: foo-emqx-data
  vol-emqx-etc:
    name: foo-emqx-etc
  vol-emqx-log:
    name: foo-emqx-log
  redis-volume:
    name: redis-volume